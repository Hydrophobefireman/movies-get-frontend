const t="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e=null!=Object.keys;function n(t,n){if(e){for(const e of Object.keys(n))t[e]=n[e];return t}for(const e in n)t[e]=n[e];return t}function o(t,e,n,o=!0){if(Array.prototype.flat){if(null==n){const n=t.flat(e);return o?n.filter(t=>null!=t&&"boolean"!=typeof t):n}return Array.prototype.flatMap?t.flatMap(n):t.flat(e).map(n)}{const r=[],l=(t,n=0)=>{if(Array.isArray(t)&&n<e)return t.forEach(t=>l(t,n+1));o&&null!=t&&r.push(t)};for(const e of t)l(e);return null!=n?r.map(n):r}}const r={},l=[],s={setAttribute(t,e,n){if(null!=n){if(e in t){if(t[e]!==n)return t[e]=n}else if(t.getAttribute(e)!==n){if(n||!1===n)return t.setAttribute(e,n);t.removeAttribute(e)}}else e in t?t[e]=0:t.removeAttribute(e)}},i=t=>"o"===t[0]&&"n"===t[1];function u(t,e){if(null==e)return;let n;null!=e._vNode&&(n=e._vNode._nextDomNode),null!=e&&e.parentNode!==t&&e!==t&&(null!=n?t.insertBefore(e,n):t.appendChild(e));const o=e.previousSibling;let r;null!=o&&null!=(r=o._vNode)&&p(r,e,"_nextDomNode");const l=e.nextSibling;let s;null!=l&&null!=(s=l._vNode)&&p(s,e,"_prevDomNode");let i=e._vNode;null!=i&&(i._prevDomNode=o)}function p(t,e,n){null!=t&&(t[n]=e,p(t._prevVnode,e,n))}function c(t,e,...n){if(null==t||"boolean"==typeof t)return null;null==e&&(e={}),n.length&&(n=o(n,Infinity),e.children=n);const r=e.ref;r&&delete e.ref;const l=e.key;l&&delete e.key;const s={};for(const t in e)i(t)&&(s[t.substr(2).toLowerCase()]=e[t]);return m(t,e,s,l,r)}function a(){}function m(t,e,n,o,r){const l={type:t,props:e,events:n,key:o,ref:r,_children:null,_dom:null,_component:null,__uAttr:null,_nextDomNode:null,_prevDomNode:null,_prevVnode:null};return l.__uAttr=l}function d(t){if(null==t||"boolean"==typeof t)return null;if("string"==typeof t||"number"==typeof t)return m(null,String(t));if(Array.isArray(t))return c(a,null,t);if(null!=t._dom){const e=m(t.type,t.props,t.events,t.key,null);return e._dom=t._dom,e}return t}const f=(t,e,...n)=>{if(t.__currentLifeCycle=e,null!=t[e])try{t[e](...n)}catch(e){if(null==t.componentDidCatch)throw e;t.componentDidCatch(e)}};function _(t,e,...n){t&&(t=f(t,e,...n))}function h(t){if(t===r||null==t)return;t._prevVnode&&h(t._prevVnode);const e=t._dom,n=t._component;if(_(n,"componentWillUnmount",!0),null!=n&&(n.base=n._vnode=null),e){if(null!=t){null!=t._nextDomNode&&p(t._nextDomNode._vNode,null,"_prevDomNode"),null!=t._prevDomNode&&p(t._prevDomNode._vNode,null,"_nextDomNode");for(const e of t._children||l)h(e);t._prevVnode=t._component=t._dom=t._prevDomNode=t._nextDomNode=null}if(t.type===a){let e;for(;e=t._children.pop();)y(e)}else y(e);e.onclick=e._component=e._listeners=e._prevVnode=e._vNode=null}}function y(t){const e=t.parentNode;e&&e.removeChild(t)}function v(t){let e;for(;e=t.pop();)_(e,"componentDidMount"),e._didMount=!0}function b(t,e,n,o){let l;const s=t.type;if(o)"string"==typeof t.props?l=document.createTextNode(t.props):C(l=document.createElement(s),t,r);else{if(s!==e.type)return b(t,null,null,!0);if(l=n,n instanceof Text){const e=t.props;n.nodeValue!==e&&(n.nodeValue=e)}else C(l,t,e)}return null!=t._prevVnode&&(t._prevVnode._dom=l),l}const g=t=>"key"!==t&&"children"!==t&&"class"!==t&&"className"!==t;function C(t,e,n){if(t instanceof Text)return;const o=e.props,l=t.attributes;!function(t,e,n){if(t!=e){null==n._listeners&&(n._listeners={},n.onclick=a),null==e&&(e=r),null==t&&(t=r);for(const o in t){const r=t[o];e[o]!==r&&null!=r&&(n.addEventListener(o,x),n._listeners[o]=r)}for(const o in e)null==t[o]&&(delete n._listeners[o],n.removeEventListener(o,x))}}(e.events,n?n.events:r,t);for(const e in o){if(i(e))continue;const n=o[e],r=l[e];if("style"!==e)!g(e)||e in l&&r===n||s.setAttribute(t,e,n);else{const e=t.style;if("string"==typeof n)e.cssText=n;else{if("string"==typeof r)e.cssText="";else for(const t in r)n&&t in n||(e[t]="");for(const t in n){const o=n[t];r&&o===r[t]||(e[t]=o)}}}}for(let e=0;e<l.length;e++){const n=l[e].name;!g(n)||n in o||s.setAttribute(t,n,null)}let u=o.class||o.className||[];!t.className||u&&u.length?("string"!=typeof u&&(u=u.join(" ")),u&&s.setAttribute(t,"class",u.trim())):t.removeAttribute("class")}function x(t){return this._listeners[t.type](t)}function N(t,e,n,o,r,l,s){const i=t._children.length,p=e.length,c=i>=p?i:p,a=[];for(let i=0;i<c;i++){let p=t._children[i],c=e[i];if(null==p){if(null==c)continue;h(c);continue}const m=k(n,p,c,o,r,l,s);if(Array.isArray(m))for(const t of m)u(n,t),a.push(t);else u(n,m),a.push(m)}return a}const D=[];class A{constructor(t,e){this.props=t,this.context=e}render(t,e){}setState(e){const o="function"==typeof e?e=e(this._nextState,this.props):e;var l;null!=o&&(this._nextState=n({},this.state||r),n(this._nextState,o),(l=this)._dirty=!0,1===D.push(l)&&(null!=window.requestAnimationFrame?window.requestAnimationFrame(P):t(P)),n(this.state,this._nextState||r))}forceUpdate(t){const e=this.parentDom,n=[];if(e){const o=this._vnode;this.base=k(e,o,o,this.context,n,this,!1!==t),this.base instanceof Node&&!this.base.parentNode&&u(e,this.base)}t&&t(),v(n)}}function P(){let t;for(D.sort((t,e)=>t._depth-e._depth);t=D.pop();)t._nextState=null,t._dirty=!1,t.forceUpdate(!1)}function S(t,e,n){return this.constructor(t,n)}function k(t,e,s,i,u,p,c){if("boolean"==typeof e&&(e=null),null!=s&&null!=e&&(e._nextDomNode=s._nextDomNode),null==s||null==e||s.type!==e.type||s.key!==e.key){if(null!=s&&s!==r&&h(s),null==e)return null;s=r}const m=s===r;if(e.__uAttr!==e)return console.warn("component not of expected type =>",e),null;e._children=o(e.props&&e.props.children||[],Infinity,d);const f=e.type;if(f===a||s.type==a){if(e.type===a)return N(e,m?l:s._children||l,t,i,u,p,c);{const t=function(t,e){for(const n of e)if(n.type===t)return n}(f,s._children||l),e=(s._children||l).filter(e=>e!==t);for(const t of e)h(t)}}if("function"==typeof f){let o;return o=function(t,e,o,r,l,s,i){let u,p,c;const a=t.type;if(e._component){if((u=t._component=e._component).base=t._dom=e._dom,u.props=t.props,u.context=l,c=!1,!s)if(null!=u.shouldComponentUpdate&&!1!==u.shouldComponentUpdate(t.props,u.state));else if(null!=u.shouldComponentUpdate)return null}else c=!0,a.prototype&&a.prototype.render?(u=t._component=new a(t.props,l),r.push(u)):(u=new A(t.props,l),t._component=null,u.constructor=a,u.render=S);return u.parentDom=o,null==u.state&&(u.state={}),u._nextState=n({},u.state),null!=a.getDerivedStateFromProps&&(u._nextState=a.getDerivedStateFromProps(t.props,u._nextState)),c?_(u,"componentWillMount"):_(u,"componentWillUpdate",t.props,u._nextState,l),u.state=u._nextState,(p=u._prevVnode=d(u.render(t.props,u.state)))&&(p._dom=t._dom),u._depth=i?1+~~i._depth:0,p}(e,s,t,u,i,c,p),null!=e._component&&(e._component._vnode=e),null==o?s._dom:(o._dom=e._dom=k(t,o,s._prevVnode||s,i,u,e._component,c),null!=e._component&&(e._component.base=e._dom),_(e._component,"componentDidUpdate",s.props,(s._component||r).state),e._prevVnode=o,null!=e._dom&&(e._dom._vNode=e),e._dom)}return e._dom=m?b(e,null,null,!0):b(e,s,s._dom,!1),null!=p&&(p.base=e._dom),e._dom._vNode=e,N(e,m?l:s._children||l,e._dom,i,u,e._component,c),e._dom}function w(t,e){const n=c(a,null,[t]),o=[],r=e._prevVnode;k(e,n,r,{},o,null==r?null:r._component,!1),v(o)}class V extends A{constructor(t,e){const{componentPromise:n,fallbackComponent:o,...r}=t;super(r,e),this.state={ready:!1,componentPromise:n,finalComponent:null,fallbackComponent:o}}static getDerivedStateFromProps(t,e){const n=e||{};return n.componentPromise===t.componentPromise?n:(null!=t.componentPromise&&(n.componentPromise=t.componentPromise,n.ready=!1,n.finalComponent=null),n)}render({eager:t=!0,loadComponent:e=!1,...n},{ready:o,finalComponent:r}){if(!t&&!e||o||this.loadComponent(),o)return c(r,n);const{...l}=n;return null!=this.state.fallbackComponent?c(this.state.fallbackComponent,l):U}loadComponent(){return this.state.componentPromise().then(t=>{this.setState({ready:!0,finalComponent:t})})}}const U=c("div",null,"Loading.."),L=[],E={subscribe(t){L.push(t)},unsubscribe(t){L.filter(e=>e!==t)},emit(t,e){for(const n of L)n(t,e)},unsubscribeAll(){L=[]}};function F(t){window.history.pushState(r,document.title,t),E.emit(t,{type:"load",native:!1})}function T(t){window.history.replaceState(r,document.title,t),E.emit(t,{type:"redirect",native:!1})}class M extends A{componentWillMount(){E.subscribe(this._routeChangeHandler),window.addEventListener("popstate",E.emit)}componentWillUnmount(){window.removeEventListener("popstate",E.emit),this.props.destroySubscriptionOnUnmount&&E.unsubscribeAll()}absolute(t){return new URL(t||"",`${location.protocol}//${location.host}`).toString()}getCurrentComponent(){return this.getPathComponent(M.getPath)||[]}_routeChangeHandler(){const[t,e]=this.getCurrentComponent();this.component=this.match=null,this.setState({component:t,match:e})}_notFoundComponent(){return c("div",null,`The Requested URL "${this.absolute(M.getPath)}" was not found`)}static get getPath(){return location.pathname}static get getQs(){return location.search}getPathComponent(t){for(const e of this.state.routes){const{regex:n,component:o}=e,r=n.exec(t);if(r)return[o,r]}return[]}initComponents(t){for(const e of t)null!=e.props&&null!=e.props.path&&this.state.routes.push({regex:e.props.path,component:e})}constructor(t,e){let{children:n,fallbackComponent:o,...r}=t;super(r,e),o=o||this._notFoundComponent.bind(this),this.state={routes:[],fallbackComponent:o},this.initComponents(n);const[l,s]=this.getCurrentComponent();this.component=l,this.match=s,this._routeChangeHandler=this._routeChangeHandler.bind(this)}render(){let t;return(t=null!=this.state.component&&null!=this.state.match?this.state.component:this.component?this.component:c(this.state.fallbackComponent,this.props)).__uAttr||(t=c(t,{match:this.state.match,...this.props})),c(a,null,t)}}function W(t){const{native:e,href:n,...o}=t,r=o;return e&&(r.href=n),e||null==t.href||(r.onClick=(e=>(function(t,e){t.altKey||t.ctrlKey||t.metaKey||t.shiftKey||(t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),F(e))})(e,t.href)),r.href=n),c("a",r)}function $(t){return RegExp(`^${t}(/?)$`)}export default A;export{w as render,c as createElement,a as Fragment,V as AsyncComponent,M as Router,F as loadURL,T as redirect,E as RouterSubscription,W as A,$ as absolutePath};
//# sourceMappingURL=ui-lib.mjs.map
