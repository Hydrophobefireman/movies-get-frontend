{"version":3,"file":"ui-lib.mjs","sources":["../src/util.js","../src/create-element.js","../src/lifeCycleRunner.js","../src/diff/dom.js","../src/diff/children.js","../src/component.js","../src/diff/toSimpleVnode.js","../src/diff/index.js","../src/render.js","../src/pkg/AsyncComponent/AsyncComponent.js","../src/pkg/router/router.js"],"sourcesContent":["/**\n * @type {(cb) => any}\n * @returns {Promise<any>}\n */\nexport const defer =\n  typeof Promise == \"function\"\n    ? Promise.prototype.then.bind(Promise.resolve())\n    : setTimeout;\n\nconst hasKeys = Object.keys != null;\nexport let assign;\nif (hasKeys) {\n  assign = function(target, src) {\n    for (const i of Object.keys(src)) {\n      target[i] = src[i];\n    }\n    return target;\n  };\n} else {\n  assign = function(target, src) {\n    for (const i in src) {\n      target[i] = src[i];\n    }\n    return target;\n  };\n}\n\n/**\n *\n * @param {Array<Array<T>>} arr\n * @param {number} depth\n * @param {()=>T} map\n * @returns {Array<T>}\n */\nexport function flattenArray(arr, depth, map, removeHoles = true) {\n  if (Array.prototype.flat) {\n    if (map == null) {\n      const flt = arr.flat(depth);\n      if (removeHoles) {\n        return flt.filter(x => x != null && typeof x !== \"boolean\");\n      }\n      return flt;\n    } else {\n      if (Array.prototype.flatMap) {\n        return arr.flatMap(map);\n      } else {\n        return arr.flat(depth).map(map);\n      }\n    }\n  } else {\n    const ret = [];\n    const itr = (el, level = 0) => {\n      if (Array.isArray(el) && level < depth) {\n        return el.forEach(c => itr(c, level + 1));\n      }\n      if (removeHoles && el != null) ret.push(el);\n    };\n    for (const i of arr) {\n      itr(i);\n    }\n    const flt = map != null ? ret.map(map) : ret;\n    return flt;\n  }\n}\nexport const EMPTY_OBJ = {};\nexport const EMPTY_ARR = [];\n\nexport const $ = {\n  /**\n   *\n   * @param {import(\"./ui\").UiElement} dom\n   * @param {string} key\n   * @param {any} value\n   */\n  setAttribute(dom, key, value) {\n    if (value == null) {\n      if (key in dom) dom[key] = 0;\n      else dom.removeAttribute(key);\n      return;\n    }\n    if (key in dom) {\n      if (dom[key] !== value) {\n        return (dom[key] = value);\n      }\n    } else {\n      if (dom.getAttribute(key) !== value) {\n        if (!value && value !== false) {\n          dom.removeAttribute(key);\n        } else {\n          return dom.setAttribute(key, value);\n        }\n      }\n    }\n  }\n};\n\nexport const isListener = attr => attr[0] === \"o\" && attr[1] === \"n\";\n\nexport function isStringLike(a) {\n  return typeof a === \"string\" || typeof a === \"number\";\n}\n\n/**\n *\n * @param {import(\"./ui\").UiElement} parentDom\n * @param {import(\"./ui\").UiNode} child\n */\nexport function appendChild(parentDom, child) {\n  if (child == null) return;\n  let insertBefore;\n  if (child._vNode != null) {\n    insertBefore = child._vNode._nextDomNode;\n  }\n  if (child != null && child.parentNode !== parentDom && child !== parentDom) {\n    if (insertBefore != null) {\n      parentDom.insertBefore(child, insertBefore);\n    } else {\n      parentDom.appendChild(child);\n    }\n  }\n  /**@type {import(\"./ui\").UiNode} */\n  const prevDom = child.previousSibling;\n  let prevVnode;\n  if (prevDom != null && (prevVnode = prevDom._vNode) != null) {\n    setDomNodeDescriptor(prevVnode, child, \"_nextDomNode\");\n  }\n  const nextDom = child.nextSibling;\n  let nextVnode;\n  if (nextDom != null && (nextVnode = nextDom._vNode) != null) {\n    setDomNodeDescriptor(nextVnode, child, \"_prevDomNode\");\n  }\n  let vn = child._vNode;\n  if (vn != null) {\n    vn._prevDomNode = prevDom;\n  }\n}\n\n/**\n *\n * @param {import(\"./ui\").vNode} node\n */\nexport function setDomNodeDescriptor(node, sibDom, desc) {\n  if (node == null) return;\n  node[desc] = sibDom;\n  const c = node._prevVnode;\n  setDomNodeDescriptor(c, sibDom, desc);\n}\n// /**\n//  *\n//  * @param {object} obj\n//  */\n// export function nulliFy(obj) {\n//   for (const i in obj) {\n//     obj[i] = null;\n//   }\n// }\n","import { isListener, flattenArray, assign, EMPTY_OBJ } from \"./util.js\";\n\nexport function createElement(type, props, ...children) {\n  if (type == null || typeof type === \"boolean\") return null;\n  if (props == null) {\n    props = {};\n  } else {\n    props = assign({}, props);\n  }\n  if (children.length) {\n    children = flattenArray(children, Infinity);\n    props.children = children;\n  }\n  const ref = props.ref;\n  if (ref) delete props.ref;\n  const key = props.key;\n  if (key) delete props.key;\n  const events = {};\n  for (const i in props) {\n    if (isListener(i)) {\n      events[i.substr(2).toLowerCase()] = props[i];\n      // delete props[i];\n    }\n  }\n  return getVNode(type, props, events, key, ref);\n}\nexport function Fragment() {}\n\nexport function getVNode(type, props, events, key, ref) {\n  /**\n   * @type {import(\"./ui\").vNode}\n   */\n  const vnode = {\n    type,\n    props,\n    events,\n    key,\n    ref,\n    _children: null,\n    _dom: null,\n    _component: null,\n    __uAttr: null,\n    _nextDomNode: null,\n    _prevDomNode: null,\n    _prevVnode: null\n  };\n  return (vnode.__uAttr = vnode);\n}\n/**\n *\n * @param {any} nodeType\n * @returns {import(\"./ui\").vNode}\n */\nexport function toVnode(nodeType) {\n  if (nodeType == null || typeof nodeType === \"boolean\") {\n    return null;\n  }\n  if (typeof nodeType === \"string\" || typeof nodeType === \"number\") {\n    return getVNode(null, String(nodeType));\n  }\n  if (Array.isArray(nodeType)) {\n    return createElement(Fragment, null, nodeType);\n  }\n\n  // Clone vnode if it has already been used.\n  if (nodeType._dom != null) {\n    const vnode = getVNode(\n      nodeType.type,\n      nodeType.props,\n      nodeType.events,\n      nodeType.key,\n      null\n    );\n    vnode._dom = nodeType._dom;\n    return vnode;\n  }\n\n  return nodeType;\n}\n","import { EMPTY_OBJ, EMPTY_ARR, setDomNodeDescriptor } from \"./util.js\";\nimport { Fragment } from \"./create-element.js\";\n\nconst _rLifeCycle = (c, m, ...a) => {\n  c.__currentLifeCycle = m;\n  if (c[m] != null) {\n    try {\n      c[m](...a);\n    } catch (e) {\n      if (c.componentDidCatch != null) {\n        c.componentDidCatch(e);\n      } else {\n        throw e;\n      }\n    }\n  }\n};\n/**\n *\n * @param {import(\"./component\").default} c\n * @param {import(\"./ui\").lifeCycleMethod} method\n * @param {boolean} [recurses]\n */\nexport function runLifeCycle(c, method, ...args) {\n  if (!c) return;\n  c = _rLifeCycle(c, method, ...args);\n}\n\n/**\n *\n * @param {import(\"./ui\").vNode} node\n */\nexport function unmountDomTree(node) {\n  if (node === EMPTY_OBJ || node == null) return;\n  if (node._prevVnode) unmountDomTree(node._prevVnode);\n  const dom = node._dom;\n  const cc = node._component;\n  runLifeCycle(cc, \"componentWillUnmount\", true);\n  if (cc != null) cc.base = cc._vnode = null;\n  if (!dom) {\n    return;\n  }\n  /**\n   * @type {import(\"./ui\").UiComponent}\n   */\n\n  // if (dom._listeners != null && dom._listeners !== EMPTY_OBJ) {\n  //   diffEventListeners(EMPTY_OBJ, dom._listeners, dom);\n  // }\n\n  if (node != null) {\n    if (node._nextDomNode != null)\n      setDomNodeDescriptor(node._nextDomNode._vNode, null, \"_prevDomNode\");\n    if (node._prevDomNode != null)\n      setDomNodeDescriptor(node._prevDomNode._vNode, null, \"_nextDomNode\");\n    for (const child of node._children || EMPTY_ARR) {\n      unmountDomTree(child);\n    }\n    node._prevVnode = node._component = node._dom = node._prevDomNode = node._nextDomNode = null;\n  }\n\n  if (node.type === Fragment) {\n    let d;\n    while ((d = node._children.pop())) {\n      removeNode(d);\n    }\n  } else {\n    removeNode(dom);\n  }\n  dom.onclick = dom._component = dom._listeners = dom._prevVnode = dom._vNode = null;\n}\n\n/**\n * @param {Node} node\n */\nexport function removeNode(node) {\n  const p = node.parentNode;\n  if (p) {\n    p.removeChild(node);\n  }\n}\nexport function commitMounts(mounts) {\n  let c;\n  while ((c = mounts.pop())) {\n    runLifeCycle(c, \"componentDidMount\");\n    c._didMount = true;\n  }\n}\n","import { $, EMPTY_OBJ, isListener } from \"../util.js\";\nimport { Fragment } from \"../create-element.js\";\n\n/**\n *\n * @param {import(\"../ui\").vNode} newVnode\n * @param {import(\"../ui\").vNode} oldVnode\n * @param {import(\"../ui\").UiNode} previousDom\n * @param {boolean} _DisableDiff\n \n \n */\nexport function diffDom(newVnode, oldVnode, previousDom, _DisableDiff) {\n  /**\n   * @type {import(\"../ui\").UiNode}\n   */\n  let el;\n  const type = newVnode.type;\n  // should be called when there is a type mismatch  or we are in a brand new vnode (nothing to diff againts)\n  if (_DisableDiff) {\n    if (typeof newVnode.props === \"string\") {\n      el = document.createTextNode(newVnode.props);\n    } else {\n      el = document.createElement(type);\n      diffAttributes(el, newVnode, EMPTY_OBJ);\n    }\n  } else {\n    const oldType = oldVnode.type;\n    if (type !== oldType) {\n      return diffDom(newVnode, null, null, true);\n    } else {\n      el = previousDom;\n      if (previousDom instanceof Text) {\n        const newVal = newVnode.props;\n        if (previousDom.nodeValue !== newVal) {\n          previousDom.nodeValue = newVal;\n        }\n      } else {\n        diffAttributes(el, newVnode, oldVnode);\n      }\n    }\n  }\n  if (newVnode._prevVnode != null) {\n    newVnode._prevVnode._dom = el;\n  }\n  return el;\n}\nconst isSafeAttr = attr =>\n  attr !== \"key\" &&\n  attr !== \"children\" &&\n  attr !== \"class\" &&\n  attr !== \"className\";\n\n/**\n *\n * @param {import(\"../ui\").UiElement} currentDom\n * @param {import(\"../ui\").vNode} currVnode\n * @param {boolean} hasOldReferenceDom\n * @param {import(\"../ui\").vNode} prevVnode\n */\nfunction diffAttributes(currentDom, currVnode, prevVnode) {\n  if (currentDom instanceof Text) return;\n  const newAttributes = currVnode.props;\n  const prevAttributes = currentDom.attributes;\n  const currEvents = currVnode.events;\n  const prevEvents = prevVnode ? prevVnode.events : EMPTY_OBJ;\n  diffEventListeners(currEvents, prevEvents, currentDom);\n  for (const attr in newAttributes) {\n    if (isListener(attr)) continue;\n    const newValue = newAttributes[attr];\n    const oldValue = prevAttributes[attr];\n    if (attr === \"style\") {\n      const st = currentDom.style;\n      if (typeof newValue === \"string\") {\n        st.cssText = newValue;\n      } else {\n        if (typeof oldValue === \"string\") {\n          st.cssText = \"\";\n        } else {\n          for (const i in oldValue) {\n            if (!newValue || !(i in newValue)) {\n              st[i] = \"\";\n            }\n          }\n        }\n        for (const i in newValue) {\n          const prop = newValue[i];\n          if (!oldValue || prop !== oldValue[i]) {\n            st[i] = prop;\n          }\n        }\n      }\n      continue;\n    }\n    if (\n      isSafeAttr(attr) &&\n      (!(attr in prevAttributes) || oldValue !== newValue)\n    ) {\n      $.setAttribute(currentDom, attr, newValue);\n    }\n  }\n  for (let i = 0; i < prevAttributes.length; i++) {\n    const attr = prevAttributes[i].name;\n    if (isSafeAttr(attr) && !(attr in newAttributes)) {\n      $.setAttribute(currentDom, attr, null);\n    }\n  }\n\n  let clsattr = newAttributes.class || newAttributes.className || [];\n  const oldClass = currentDom.className;\n  if (oldClass && (!clsattr || !clsattr.length)) {\n    return void currentDom.removeAttribute(\"class\");\n  }\n  if (typeof clsattr !== \"string\") {\n    clsattr = clsattr.join(\" \");\n  }\n  if (clsattr) $.setAttribute(currentDom, \"class\", clsattr.trim());\n}\n\n/**\n *\n * @param {Event} e\n * @this {import(\"../ui\").UiElement}\n */\nexport function eventListenerProxy(e) {\n  return this._listeners[e.type](e);\n}\n\n/**\n *\n * @param {import(\"../ui\").vNode['events']} newListeners\n * @param {import(\"../ui\").vNode['events']} oldListeners\n * @param {import(\"../ui\").UiElement} dom\n */\nexport function diffEventListeners(newListeners, oldListeners, dom) {\n  if (newListeners == oldListeners) return;\n  if (dom._listeners == null) {\n    dom._listeners = {};\n    dom.onclick = Fragment;\n  }\n  if (oldListeners == null) {\n    oldListeners = EMPTY_OBJ;\n  }\n  if (newListeners == null) {\n    newListeners = EMPTY_OBJ;\n  }\n  for (const event in newListeners) {\n    const listener = newListeners[event];\n    const oldListener = oldListeners[event];\n    if (oldListener !== listener && listener != null) {\n      dom.addEventListener(event, eventListenerProxy);\n      dom._listeners[event] = listener;\n    }\n  }\n  for (const evt in oldListeners) {\n    if (newListeners[evt] == null) {\n      delete dom._listeners[evt];\n      dom.removeEventListener(evt, eventListenerProxy);\n    }\n  }\n}\n","import { unmountDomTree } from \"../lifeCycleRunner.js\";\nimport { diff } from \"./index.js\";\n\nimport { appendChild } from \"../util.js\";\n\n/**\n *\n * @param {import(\"../ui\").vNode} newParentVnode\n * @param {import(\"../ui\").vNode['_children']} oldChildren\n * @param {import(\"../ui\").UiElement} parentDom\n * @param {object} context\n * @param {Array<import(\"../ui\").UiComponent>} mounts\n * @param {import(\"../ui\").UiComponent} previousComponent\n * @param {boolean} force\n */\n\nexport function diffChildren(\n  newParentVnode,\n  oldChildren,\n  parentDom,\n  context,\n  mounts,\n  previousComponent,\n  force\n) {\n  const newChildrenLength = newParentVnode._children.length;\n  const oldChildrenLength = oldChildren.length;\n  const largerNodesLength =\n    newChildrenLength >= oldChildrenLength\n      ? newChildrenLength\n      : oldChildrenLength;\n\n  const retArr = [];\n\n  for (let i = 0; i < largerNodesLength; i++) {\n    let newChild = newParentVnode._children[i];\n    let oldChild = oldChildren[i];\n    if (newChild == null) {\n      if (oldChild == null) {\n        continue;\n      }\n      unmountDomTree(oldChild);\n      continue;\n    }\n    const dom = diff(\n      parentDom,\n      newChild,\n      oldChild,\n      context,\n      mounts,\n      previousComponent,\n      force\n    );\n    const isFragmentChildren = Array.isArray(dom);\n    if (isFragmentChildren) {\n      for (const c of dom) {\n        appendChild(parentDom, c);\n        retArr.push(c);\n      }\n    } else {\n      appendChild(parentDom, dom);\n      retArr.push(dom);\n    }\n  }\n  return retArr;\n  /**@todo keys */\n}\n","import { defer, assign, EMPTY_OBJ, appendChild } from \"./util.js\";\nimport { commitMounts } from \"./lifeCycleRunner.js\";\nimport { diff } from \"./diff/index.js\";\n/**\n * @type {Array<import(\"./ui\").UiComponent>}\n */\nconst RENDER_QUEUE = [];\nclass Component {\n  constructor(props, context) {\n    // /**\n    //  * @type {import(\"./ui\").vNode}\n    //  */\n    // this._vnode = null;\n    // /**\n    //  * @type {Component}\n    //  */\n    // this._previousComponent = null;\n    // /**\n    //  * @type {import(\"./ui\").lifeCycleMethod}\n    //  */\n    // this.__currentLifeCycle = null;\n    this.props = props;\n    this.context = context;\n  }\n  /**\n   * @param {import(\"./ui\").UiComponent['props']} props\n   * @param {import(\"./ui\").UiComponent['state']} state\n   * @returns {import(\"./ui\").vNode}\n   */\n  render(props, state) {\n    return;\n  }\n  setState(updater) {\n    const next =\n      typeof updater === \"function\"\n        ? (updater = updater(this._nextState, this.props))\n        : updater;\n    if (next == null) return;\n    this._nextState = assign({}, this.state || EMPTY_OBJ);\n    this._oldState = assign({}, this._nextState);\n    assign(this._nextState, next);\n    enqueueRender(this);\n    assign(this.state, this._nextState || EMPTY_OBJ);\n  }\n  forceUpdate(callback) {\n    const parentDom = this.parentDom;\n    const mounts = [];\n    if (parentDom) {\n      const force = callback !== false;\n      /**\n       * @type {import(\"./ui\").vNode}\n       */\n      const vn = this._vnode;\n      const _sibDom = vn != null ? vn._nextDomNode : null;\n\n      /**\n       * @type {import(\"./ui\").UiNode}\n       */\n      this.base = diff(parentDom, vn, vn, this.context, mounts, this, force);\n      if (this.base instanceof Node && !this.base.parentNode) {\n        appendChild(parentDom, this.base, _sibDom);\n      }\n    }\n    if (callback) callback();\n    commitMounts(mounts);\n  }\n}\nexport function enqueueRender(c) {\n  c._dirty = true;\n  if (RENDER_QUEUE.push(c) === 1) {\n    window.requestAnimationFrame != null\n      ? window.requestAnimationFrame(process)\n      : defer(process);\n  }\n}\n\nfunction process() {\n  let p;\n  RENDER_QUEUE.sort((x, y) => x._depth - y._depth);\n  while ((p = RENDER_QUEUE.pop())) {\n    p._nextState = null;\n    p._dirty = false;\n    p.forceUpdate(false);\n  }\n}\nexport default Component;\n","import { runLifeCycle } from \"../lifeCycleRunner.js\";\nimport Component from \"../component.js\";\nimport { assign, EMPTY_OBJ, EMPTY_ARR } from \"../util.js\";\nimport { toVnode } from \"../create-element.js\";\n\n/**\n *\n * @param {import(\"../ui\").vNode} newVnode\n * @param {import(\"../ui\").vNode} oldVnode\n * @param {import(\"../ui\").UiElement} parentDom\n * @param {Array<import(\"../ui\").UiComponent>} mounts\n * @param {object} context\n * @param {boolean} force\n */\nexport function toSimpleVnode(\n  newVnode,\n  oldVnode,\n  parentDom,\n  mounts,\n  context,\n  force,\n  previousComponent\n) {\n  /**\n   * @type {import(\"../ui\").UiComponent}\n   */\n  let c;\n  /**\n   * @type {import(\"../ui\").vNode}\n   */\n  let vnode;\n  let isNew;\n  const newType = newVnode.type;\n  if (oldVnode._component) {\n    c = newVnode._component = oldVnode._component;\n    c.base = newVnode._dom = oldVnode._dom;\n    c.props = newVnode.props;\n    c.context = context;\n    isNew = false;\n    if (!force) {\n      if (\n        c.shouldComponentUpdate != null &&\n        c.shouldComponentUpdate(newVnode.props, c.state) !== false\n      ) {\n      } else if (c.shouldComponentUpdate != null) {\n        return EMPTY_OBJ;\n      }\n    }\n  } else {\n    isNew = true;\n    if (newType.prototype && newType.prototype.render) {\n      c = newVnode._component = new newType(newVnode.props, context);\n      mounts.push(c);\n    } else {\n      c = new Component(newVnode.props, context);\n      newVnode._component = null;\n      c.constructor = newType;\n      c.render = getRenderer;\n    }\n  }\n  c.parentDom = parentDom;\n  if (c.state == null) c.state = {};\n  c._nextState = assign({}, c.state);\n  if (newType.getDerivedStateFromProps != null) {\n    assign(\n      c._nextState,\n      newType.getDerivedStateFromProps(newVnode.props, c._nextState) ||\n        EMPTY_OBJ\n    );\n    assign(c._oldState || (c._oldState = {}), c._nextState);\n  }\n\n  if (isNew) {\n    runLifeCycle(c, \"componentWillMount\");\n  } else {\n    runLifeCycle(\n      c,\n      \"componentWillUpdate\",\n      newVnode.props,\n      c._nextState,\n      context\n    );\n  }\n  c.state = c._nextState;\n  vnode = c._prevVnode = toVnode(c.render(newVnode.props, c.state));\n  if (vnode) vnode._dom = newVnode._dom; //we maybe rendering null\n  c._depth = previousComponent ? ~~previousComponent._depth + 1 : 0;\n  return vnode;\n}\n\nfunction getRenderer(props, _, context) {\n  return this.constructor(props, context);\n}\n","/**\n *  @TODO refactor loops and fix variable naming\n */\nimport { Fragment, toVnode } from \"../create-element.js\";\nimport { flattenArray, EMPTY_OBJ, EMPTY_ARR } from \"../util.js\";\nimport { unmountDomTree, runLifeCycle } from \"../lifeCycleRunner.js\";\nimport { diffDom } from \"./dom.js\";\nimport { diffChildren } from \"./children.js\";\nimport { toSimpleVnode } from \"./toSimpleVnode.js\";\n/**\n *\n * @param {import(\"../ui\").UiElement} parentDom\n * @param {import(\"../ui\").vNode} newVnode\n * @param {import(\"../ui\").vNode} oldVnode\n * @param {object} context\n * @param {Array<import(\"../ui\").UiComponent>} mounts\n * @param {import(\"../ui\").UiComponent} previousComponent\n * @param {boolean} force\n */\nexport function diff(\n  parentDom,\n  newVnode,\n  oldVnode,\n  context,\n  mounts,\n  previousComponent,\n  force\n) {\n  if (typeof newVnode === \"boolean\") {\n    newVnode = null;\n  }\n  if (oldVnode != null && newVnode != null) {\n    newVnode._nextDomNode = oldVnode._nextDomNode;\n  }\n  if (\n    oldVnode == null ||\n    newVnode == null ||\n    oldVnode.type !== newVnode.type ||\n    oldVnode.key !== newVnode.key\n  ) {\n    if (oldVnode != null && oldVnode !== EMPTY_OBJ) {\n      unmountDomTree(oldVnode);\n    }\n    if (newVnode == null) {\n      return null;\n    }\n    oldVnode = EMPTY_OBJ;\n  }\n  const shouldGenerateNewTree = oldVnode === EMPTY_OBJ;\n\n  if (newVnode.__uAttr !== newVnode) {\n    console.warn(\"component not of expected type =>\", newVnode);\n    return null;\n  }\n\n  newVnode._children = flattenArray(\n    (newVnode.props && newVnode.props.children) || [],\n    Infinity,\n    toVnode\n  );\n  const newType = newVnode.type;\n  if (newType === Fragment || oldVnode.type == Fragment) {\n    if (newVnode.type !== Fragment) {\n      const oldSimilarChild = getSimilarChildTo(\n        newType,\n        oldVnode._children || EMPTY_ARR\n      );\n      const removeChildren = (oldVnode._children || EMPTY_ARR).filter(\n        x => x !== oldSimilarChild\n      );\n      for (const c of removeChildren) {\n        unmountDomTree(c);\n      }\n    } else {\n      return diffChildren(\n        newVnode,\n        shouldGenerateNewTree ? EMPTY_ARR : oldVnode._children || EMPTY_ARR,\n        parentDom,\n        context,\n        mounts,\n        previousComponent,\n        force\n      );\n    }\n  }\n  if (typeof newType === \"function\") {\n    let node;\n    node = toSimpleVnode(\n      newVnode,\n      oldVnode,\n      parentDom,\n      mounts,\n      context,\n      force,\n      previousComponent\n    );\n    if (newVnode._component != null) newVnode._component._vnode = newVnode;\n    if (node === EMPTY_OBJ) return null; //scu returned false\n    if (node == null) return oldVnode._dom;\n    node._dom = newVnode._dom = diff(\n      parentDom,\n      node,\n      oldVnode._prevVnode || oldVnode,\n      context,\n      mounts,\n      newVnode._component,\n      force\n    );\n    if (newVnode._component != null) newVnode._component.base = newVnode._dom;\n    runLifeCycle(\n      newVnode._component,\n      \"componentDidUpdate\",\n      oldVnode.props,\n      (oldVnode._component || EMPTY_OBJ)._oldState\n    );\n    if (oldVnode._component != null) delete oldVnode._component._oldState;\n    newVnode._prevVnode = node;\n    if (newVnode._dom != null) {\n      newVnode._dom._vNode = newVnode;\n    }\n    return newVnode._dom;\n  } else {\n    if (shouldGenerateNewTree) {\n      newVnode._dom = diffDom(newVnode, null, null, true);\n    } else {\n      newVnode._dom = diffDom(newVnode, oldVnode, oldVnode._dom, false);\n    }\n    if (previousComponent != null) {\n      previousComponent.base = newVnode._dom;\n    }\n  }\n  newVnode._dom._vNode = newVnode;\n  diffChildren(\n    newVnode,\n    shouldGenerateNewTree ? EMPTY_ARR : oldVnode._children || EMPTY_ARR,\n    newVnode._dom,\n    context,\n    mounts,\n    newVnode._component,\n    force\n  );\n  // if (oldVnode._component != null) {\n  //   runLifeCycle(newVnode._component, \"componentDidUpdate\");\n  // }\n  return newVnode._dom;\n}\n\n/**\n *\n * @param {import(\"../ui\").vNode['type']} type\n * @param {import(\"../ui\").vNode['_children']} childArr\n */\nfunction getSimilarChildTo(type, childArr) {\n  for (const child of childArr) {\n    if (child.type === type) {\n      return child;\n    }\n  }\n}\n","import { diff } from \"./diff/index.js\";\nimport { Fragment, createElement } from \"./create-element.js\";\nimport { commitMounts } from \"./lifeCycleRunner.js\";\n/**\n *\n * @param {import(\"./ui\").vNode} vn\n * @param {import(\"./ui\").UiElement} parentDom\n */\nexport function render(vn, parentDom) {\n  const vnode = createElement(Fragment, null, [vn]);\n  const mounts = [];\n  const oldVnode = parentDom._prevVnode;\n  // parentDom._prevVnode = vnode;\n  diff(\n    parentDom,\n    vnode,\n    oldVnode,\n    {},\n    mounts,\n    oldVnode == null ? null : oldVnode._component,\n    false,\n    null\n  );\n  commitMounts(mounts);\n}\n","import Component from \"../../component.js\";\nimport { createElement as h } from \"../../create-element.js\";\n\nclass AsyncComponent extends Component {\n  constructor(props, context) {\n    const { componentPromise, fallbackComponent, ..._props } = props;\n    super(_props, context);\n    this.state = {\n      ready: false,\n      componentPromise,\n      finalComponent: null,\n      fallbackComponent\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    const s = state || {};\n    if (s.componentPromise === props.componentPromise) return s;\n    // we are still in a promise..let that load first or we will get stuck in an infinite loop\n    if (props.componentPromise != null) {\n      s.componentPromise = props.componentPromise;\n      s.ready = false;\n      s.finalComponent = null;\n    }\n    return s;\n  }\n  render(\n    { eager = true, loadComponent = false, ...props },\n    { ready, finalComponent }\n  ) {\n    if ((eager || loadComponent) && !ready) {\n      this.loadComponent();\n    }\n    if (ready) {\n      return h(finalComponent, props);\n    }\n    const { children, ..._props } = props;\n    return this.state.fallbackComponent != null\n      ? h(this.state.fallbackComponent, _props)\n      : _defaultLoader;\n  }\n\n  loadComponent() {\n    return this.state.componentPromise().then(ct => {\n      this.setState({ ready: true, finalComponent: ct });\n    });\n  }\n}\nconst _defaultLoader = h(\"div\", null, \"Loading..\");\nexport default AsyncComponent;\nexport { AsyncComponent as LazyComponent };\n","import Component from \"../../component.js\";\nimport { createElement as h, Fragment } from \"../../create-element.js\";\nimport { EMPTY_OBJ } from \"../../util.js\";\n/**\n * @type {Array<(e:PopStateEvent|null)=>any>}\n */\nconst _routerSubscriptions = [];\nexport const RouterSubscription = {\n  /**\n   * @param {(e:PopStateEvent|null)=>any} fun\n   */\n  subscribe(fun) {\n    _routerSubscriptions.push(fun);\n  },\n  unsubscribe(fun) {\n    _routerSubscriptions.filter(fn => fn !== fun);\n  },\n  /**\n   * @param {PopStateEvent|null} e\n   */\n  emit(e, options) {\n    for (const subscription of _routerSubscriptions) {\n      subscription(e, options);\n    }\n  },\n  unsubscribeAll() {\n    _routerSubscriptions = [];\n  }\n};\n\nexport function loadURL(url) {\n  window.history.pushState(EMPTY_OBJ, document.title, url);\n  RouterSubscription.emit(url, { type: \"load\", native: false });\n}\nexport function redirect(url) {\n  window.history.replaceState(EMPTY_OBJ, document.title, url);\n  RouterSubscription.emit(url, { type: \"redirect\", native: false });\n}\nclass Router extends Component {\n  componentWillMount() {\n    RouterSubscription.subscribe(this._routeChangeHandler);\n    window.addEventListener(\"popstate\", RouterSubscription.emit);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"popstate\", RouterSubscription.emit);\n    if (this.props.destroySubscriptionOnUnmount) {\n      RouterSubscription.unsubscribeAll();\n    }\n  }\n  absolute(path) {\n    return new URL(\n      path || \"\",\n      `${location.protocol}//${location.host}`\n    ).toString();\n  }\n  getCurrentComponent() {\n    const currentPath = Router.getPath;\n    return this.getPathComponent(currentPath) || [];\n  }\n  _routeChangeHandler() {\n    const [component, match] = this.getCurrentComponent();\n    this.component = this.match = null;\n    this.setState({ component, match });\n  }\n  _notFoundComponent() {\n    return h(\n      \"div\",\n      null,\n      `The Requested URL \"${this.absolute(Router.getPath)}\" was not found`\n    );\n  }\n  static get getPath() {\n    return location.pathname;\n  }\n  static get getQs() {\n    return location.search;\n  }\n  /**\n   * @returns {[any,RegExpExecArray]}\n   */\n  getPathComponent(route) {\n    for (const obj of this.state.routes) {\n      const { regex, component } = obj;\n      const match = regex.exec(route);\n      if (match) {\n        return [component, match];\n      }\n    }\n    return [];\n  }\n  initComponents(c) {\n    for (const child of c) {\n      if (child.props != null && child.props.path != null) {\n        this.state.routes.push({\n          regex: child.props.path,\n          component: child\n        });\n      }\n    }\n  }\n  /**\n   *\n   * @param {{children:Array<import(\"../ui\").vNode>}} routerProps\n   * @param {object} context\n   */\n  constructor(routerProps, context) {\n    let { children, fallbackComponent, ...props } = routerProps;\n    super(props, context);\n    fallbackComponent = fallbackComponent || this._notFoundComponent.bind(this);\n    this.state = { routes: [], fallbackComponent };\n    this.initComponents(children);\n    const [component, match] = this.getCurrentComponent();\n    this.component = component;\n    this.match = match;\n    this._routeChangeHandler = this._routeChangeHandler.bind(this);\n  }\n  render() {\n    /**\n     * @type {import(\"../../ui\").vNode}\n     */\n    let c;\n    if (this.state.component != null && this.state.match != null) {\n      c = this.state.component;\n    } else if (this.component) {\n      c = this.component;\n    } else {\n      c = h(this.state.fallbackComponent, this.props);\n    }\n    if (!c.__uAttr) c = h(c, { match: this.state.match, ...this.props });\n    return h(Fragment, null, c);\n  }\n}\n\nexport function A(props) {\n  const { native, href, onClick, ...p } = props;\n  const setProps = p;\n  setProps.href = href;\n  if (!native && href != null) {\n    setProps.onClick = e => onLinkClick(e, props.href, onClick);\n  }\n  return h(\"a\", setProps);\n}\n/**\n *\n * @param {MouseEvent} e\n */\nfunction onLinkClick(e, href, func) {\n  if (e.altKey || e.ctrlKey || e.metaKey || e.shiftKey) {\n    return;\n  }\n  if (e.stopImmediatePropagation) {\n    e.stopImmediatePropagation();\n  }\n  if (e.stopPropagation) {\n    e.stopPropagation();\n  }\n  e.preventDefault();\n  loadURL(href);\n  if (func != null) func(e, href);\n}\nexport function absolutePath(route) {\n  return RegExp(`^${route}(/?)$`);\n}\n\nexport default Router;\n"],"names":["defer","Promise","prototype","then","bind","resolve","setTimeout","hasKeys","Object","keys","assign","flattenArray","arr","depth","map","removeHoles","Array","flat","flt","filter","x","flatMap","ret","itr","el","level","isArray","forEach","c","push","i","target","src","EMPTY_OBJ","EMPTY_ARR","$","[object Object]","dom","key","value","getAttribute","setAttribute","removeAttribute","isListener","attr","appendChild","parentDom","child","insertBefore","_vNode","_nextDomNode","parentNode","prevDom","previousSibling","prevVnode","setDomNodeDescriptor","nextDom","nextSibling","nextVnode","vn","_prevDomNode","node","sibDom","desc","_prevVnode","createElement","type","props","children","length","Infinity","ref","events","substr","toLowerCase","getVNode","Fragment","vnode","_children","_dom","_component","__uAttr","toVnode","nodeType","String","_rLifeCycle","m","a","__currentLifeCycle","e","componentDidCatch","runLifeCycle","method","args","unmountDomTree","cc","base","_vnode","d","pop","removeNode","onclick","_listeners","p","removeChild","commitMounts","mounts","_didMount","diffDom","newVnode","oldVnode","previousDom","_DisableDiff","document","createTextNode","diffAttributes","Text","newVal","nodeValue","isSafeAttr","currentDom","currVnode","newAttributes","prevAttributes","attributes","newListeners","oldListeners","event","listener","addEventListener","eventListenerProxy","evt","removeEventListener","diffEventListeners","newValue","oldValue","st","style","cssText","prop","name","clsattr","class","className","join","trim","this","diffChildren","newParentVnode","oldChildren","context","previousComponent","force","newChildrenLength","oldChildrenLength","largerNodesLength","retArr","newChild","oldChild","diff","RENDER_QUEUE","Component","state","updater","next","_nextState","_oldState","_dirty","window","requestAnimationFrame","process","callback","Node","sort","y","_depth","forceUpdate","getRenderer","_","constructor","shouldGenerateNewTree","console","warn","newType","oldSimilarChild","childArr","getSimilarChildTo","removeChildren","isNew","shouldComponentUpdate","render","getDerivedStateFromProps","toSimpleVnode","AsyncComponent","componentPromise","fallbackComponent","_props","super","ready","finalComponent","s","eager","loadComponent","h","_defaultLoader","ct","setState","_routerSubscriptions","RouterSubscription","fun","fn","options","subscription","loadURL","url","history","pushState","title","emit","native","redirect","replaceState","Router","subscribe","_routeChangeHandler","destroySubscriptionOnUnmount","unsubscribeAll","path","URL","location","protocol","host","toString","getPathComponent","getPath","component","match","getCurrentComponent","absolute","pathname","getQs","search","route","obj","routes","regex","exec","routerProps","_notFoundComponent","initComponents","A","href","onClick","setProps","func","altKey","ctrlKey","metaKey","shiftKey","stopImmediatePropagation","stopPropagation","preventDefault","onLinkClick","absolutePath","RegExp"],"mappings":"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"}